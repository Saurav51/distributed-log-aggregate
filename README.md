# Distributed Log Aggregate

This project implements a distributed log aggregation service using FastAPI. The service supports real-time ingestion and querying of logs generated by different microservices.

## ðŸš€ Setup & Installation
Prerequisites: Python 3.8+

1. Clone the repository
2. Create and activate a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  
3. Install all the necessary packages: 
   ````bash
   pip3 install -r requirements.txt    
4. Start the service: 
    ````bash
    uvicorn main:app --host 0.0.0.0 --port 8000 --reload

## ðŸŽ¯ Architecture

### Data Structure
```bash
log_store = { "service_name": SortedList[(timestamp, message)] }
``` 
The data structure is a dictionary where:
1. Each key represents the name of a microservice.
2. Each value is a sorted collection of log entries, ordered by timestamp.
3. Each log entry consists of a timestamp and a message.

Time Complexity: 
1. Insertion Complexity: O(log N) using SortedList 
2. Query Complexity: O(log N + K) using binary search

Terms Used: 
1. N: Number of log records for a particular service in the last 1 hour. 
2. K: Number of records which fit in the filter of service_name, start_timestamp and end_timestamp.

### Concurrency Handling & Thread-Safe 
Read-Write Lock Strategy: 
1. Read locks are shared, allowing multiple readers to query logs concurrently without blocking each other.

2. Write locks are exclusive, ensuring that no read or write operation can occur while a log entry is being modified.

3. This improves performance by allowing frequent reads while preventing race conditions during writes. 


### Cleanup of logs > 60 mins 
A thread runs in the background which removes logs older than 1 hour every 60 seconds.

### Handling Unordered Logs
Since logs may arrive out of order, the SortedList data structure automatically maintains logs in sorted order by timestamp. This ensures that query results are always returned in the correct order.


## ðŸ“š Testing 

1. Add a log record using the POST API  
```bash
curl -X POST "http://127.0.0.1:8000/logs" -H "Content-Type: application/json" -d '{"service_name":"auth-service","timestamp":"2025-03-17T10:15:00Z","message":"User login successful"}'
```

2. Fetch log records using the GET API 
```bash 
curl -X GET "http://127.0.0.1:8000/logs?service=auth-service&start=2025-03-17T10:00:00Z&end=2025-03-17T10:30:00Z"

```


## ðŸ“· Future Improvements

1. Support persistent storage (e.g., redis cache or file-based storage).
2. Add authentication and rate limiting.
3. Deployment using docker and kubernetes. 

## ðŸ“¬ Contact 
For questions or suggestions, reach out to me at:
- School Email: sgnayak2@illinois.edu
- Personal Email: sauravnayak51@gmail.com 
- Phone: +1 (217)255-0581
